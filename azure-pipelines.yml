trigger:
- main

pool:
  name: Azure Pipelines
  vmImage: 'latest'

steps:
- task: TerraformInstaller@1
  inputs:
    terraformVersion: 'latest'

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : INIT'
  inputs:
    azureResourceManagerConnection: 'azure-cpg-test'
    subscriptionId: $(subscriptionId)
    resourceGroupName: $(resourceGroupName)

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : PLAN'
  inputs:
    command: plan
    environmentServiceNameAzureRM: 'azure-cpg-test'

- task: ms-devlabs.custom-terraform-tasks.custom-terraform-release-task.TerraformTaskV1@0
  displayName: 'Terraform : VAL & APPLY'
  inputs:
    command: apply
    environmentServiceNameAzureRM: 'azure-cpg-test'
